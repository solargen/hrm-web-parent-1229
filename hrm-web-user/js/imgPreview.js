(function(e){e.fn.imagePreview=function(){e(this).hover(function(){if(e(this).data("preview-hover")!=undefined&&(e(this).data("preview-hover")==false||e(this).data("preview-hover")=="false")){return}var i=e(this).children().width();var t=e(this).attr("title");var a=e(this).attr("ref");var r=e(this).attr("data-file");try{if(r&&r!=""){r=e("#"+r)}}catch(n){}var s=t&&t!=""?"<br/>"+t:"";if(r&&typeof r=="object"){r=e(r).get(0);if(r.files&&r.files[0]){e(this).append("<p id='imgpreview'><img />"+s+"</p>");var d=e("#imgpreview").find("img").get(0);d.onload=function(){};var f=new FileReader;f.onload=function(i){d.src=i.target.result;e(d).data("src",i.target.result)};f.readAsDataURL(r.files[0]);return}}if(a!=""){e(this).append("<p id='imgpreview'><img src='"+a+"' />"+s+"</p>");e("#imgpreview").css("left",i+10+"px").fadeIn("fast")}else{e(this).attr("ref","/images/default/goods.gif");e(this).append("<p id='imgpreview'><img src='/images/default/goods.gif'/>"+s+"</p>");e("#imgpreview").css("left",i+10+"px").fadeIn("fast")}},function(){e("#imgpreview").remove()}).mousemove(function(){var i=e(this).children().width();e("#imgpreview").css("left",i+10+"px").fadeIn("fast")}).click(function(){if(e(this).data("preview-click")!=undefined&&(e(this).data("preview-click")==false||e(this).data("preview-click")=="false")){return}var i=e(this).attr("ref");var t=e(this).attr("data-file");var a=i;try{if(t&&t!=""){t=e("#"+t)}}catch(r){}if(t&&typeof t=="object"){var t=e(t).get(0);if(t.files&&t.files[0]){a=e("#imgpreview").find("img").attr("src")}else{a=i}}else if(i&&i!=""){a=i}var n=e("#imgpreview").width();var s=e("#imgpreview").height();if(e.isFunction(e.open)){var n=e("#imgpreview").width();var s=e("#imgpreview").height();var d=e(window).width()-50;var f=e(window).height()-50;var o="<p style='background: #FFF; padding: 3px; border: solid 1px #DDD;'><img id='imgpreview_handle' src='"+a+"' style='max-width: "+d+"px;max-height: "+f+"px;'/></p>";top.$.open({type:1,title:false,move:"#imgpreview_handle",scrollbar:true,closeBtn:1,area:[d,f],skin:"layui-layer-nobg",shadeClose:true,content:o})}else{window.open(i)}})}})(jQuery);$(document).ready(function(){$("body").on("mouseover","a.preview",function(){if($(this).data("imagepreview")==undefined){$(this).data("imagepreview",true);$(this).imagePreview();$(this).mouseover()}})});$.fn.extend({uploadPreview:function(e){var i=this,t=$(this);e=jQuery.extend({Img:"img-pr",Width:100,Height:100,ImgType:["gif","jpeg","jpg","bmp","png"],Callback:function(){}},e||{});i.getObjectURL=function(e){var i=null;if(window.createObjectURL!=undefined){i=window.createObjectURL(e)}else if(window.URL!=undefined){i=window.URL.createObjectURL(e)}else if(window.webkitURL!=undefined){i=window.webkitURL.createObjectURL(e)}return i};t.change(function(){if(this.value){if(!RegExp(".("+e.ImgType.join("|")+")$","i").test(this.value.toLowerCase())){$.alert("选择文件错误,图片类型必须是"+e.ImgType.join("，")+"中的一种",{icon:2});this.value="";return false}$("#"+e.Img+" .fild-box").hide();$("#"+e.Img+" .image-wrap a").show();$("#"+e.Img+" .image-wrap img").attr("src",i.getObjectURL(this.files[0]));$("#"+e.Img+" .image-wrap input").val(i.getObjectURL(this.files[0]));e.Callback()}});$("body").on("click","#"+e.Img+" .image-wrap a",function(){$("#"+e.Img+" .fild-box").show();$("#"+e.Img+" .image-wrap a").hide();$("#"+e.Img+" .image-wrap img").removeAttr("src");$("#"+e.Img+" .image-wrap input").val("")})}});