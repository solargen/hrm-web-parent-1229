(function($){var lastUuid=0;function uuid(){return(new Date).getTime()*1e3+lastUuid++%1e3}var settings={url:"/upload/file",data:{},secureuri:false,fileElementId:null,dataType:"json",success:null,error:function(e,t,a){alert(a)}};settings.data[$.getCsrfParam()]=$.getCsrfToken();$.ajaxFileImageUpload=function(e){e=$.extend(settings,{url:"/upload/image"},e);e.data.attribute=$("#"+e.fileElementId).attr("name");var t=e.fileElementId;var a=e.fieldElementId;if(!$.isFunction(e.success)){e.success=function(e,r){if(e.code==0&&e.data){var n=e.data.url;var o=e.data.value;$("#"+t+"_image").attr("ref",n);$("#"+a).val(o)}else if(e.message){if($.validator){$.validator.showError($("#"+t),e.message)}else{alert(e.message)}}}}$.ajaxFileUpload(e)};$.ajaxFileUpload=function(e){e=$.extend(settings,e);e.data[$.getCsrfParam()]=$.getCsrfToken();var t=(new Date).getTime();var a=e.createUploadForm(t,e.fileElementId,typeof e.data=="undefined"?false:e.data);var r=e.createUploadIframe(t,e.secureuri);var n="jUploadFrame"+t;var o="jUploadForm"+t;if(e.global&&!$.active++){$.event.trigger("ajaxStart")}var i=false;var l={};if(e.global){$.event.trigger("ajaxSend",[l,e])}var s=function(t){var r=document.getElementById(n);try{if(r.contentWindow){l.responseText=r.contentWindow.document.body?r.contentWindow.document.body.innerHTML:null;l.responseXML=r.contentWindow.document.XMLDocument?r.contentWindow.document.XMLDocument:r.contentWindow.document}else if(r.contentDocument){l.responseText=r.contentDocument.document.body?r.contentDocument.document.body.innerHTML:null;l.responseXML=r.contentDocument.document.XMLDocument?r.contentDocument.document.XMLDocument:r.contentDocument.document}}catch(o){e.handleError(e,l,null,o)}if(l||t=="timeout"){i=true;var s;try{s=t!="timeout"?"success":"error";if(s!="error"){var c=e.uploadHttpData(l,e.dataType);if(e.success){e.success(c,s)}if(e.global){$.event.trigger("ajaxSuccess",[l,e])}}else{e.handleError(e,l,s)}}catch(o){s="error";e.handleError(e,l,s,o)}if(e.global){$.event.trigger("ajaxComplete",[l,e])}if(e.global&&!--$.active){$.event.trigger("ajaxStop")}if(e.complete){e.complete(l,s)}$(r).unbind();setTimeout(function(){try{$(r).remove();$(a).remove()}catch(t){e.handleError(e,l,null,t)}},100);l=null}};if(e.timeout>0){setTimeout(function(){if(!i){s("timeout")}},e.timeout)}try{var a=$("#"+o);$(a).attr("action",e.url);$(a).attr("method","POST");$(a).attr("target",n);if(a.encoding){$(a).attr("encoding","multipart/form-data")}else{$(a).attr("enctype","multipart/form-data")}$(a).submit()}catch(c){e.handleError(e,l,null,c)}$("#"+n).load(s);return{abort:function(){}}};settings.createUploadIframe=function(e,t){var a="jUploadFrame"+e;var r='<iframe id="'+a+'" name="'+a+'" style="position:absolute; top:-9999px; left:-9999px"';if(window.ActiveXObject){if(typeof t=="boolean"){r+=' src="'+"javascript:false"+'"'}else if(typeof t=="string"){r+=' src="'+t+'"'}}r+=" />";$(r).appendTo(document.body);return $("#"+a).get(0)};settings.createUploadForm=function(e,t,a){var r="jUploadForm"+e;var n="jUploadFile"+e;var o=jQuery('<form  action="" method="POST" name="'+r+'" id="'+r+'" enctype="multipart/form-data" ></form>');if(a){a=$.extend(a,this.getCsrf());for(var i in a){var l=uuid();var s=$('<input type="hidden" id="'+l+'" name="'+i+'" value="" />');$(s).val(a[i]);$(s).appendTo(o)}}var c=jQuery("#"+t);var d=jQuery(c).clone();$(c).attr("id",n);$(c).before(d);$(c).appendTo(o);$(o).css("position","absolute");$(o).css("top","-1200px");$(o).css("left","-1200px");$(o).appendTo("body");return o};settings.uploadHttpData=function(r,type){var data=!type;data=type=="xml"||data?r.responseXML:r.responseText;if(type=="script"){$.globalEval(data)}if(type=="json"){eval("data = "+data)}if(type=="html"){$("<div>").html(data).evalScripts()}return data};settings.handleError=function(e,t,a,r){if(e.error){e.error.call(e.context||e,t,a,r)}if(e.global){(e.context?$(e.context):$.event).trigger("ajaxError",[t,e,r])}};settings.getCsrfParam=function(){return $("meta[name=csrf-param]").attr("content")};settings.getCsrfToken=function(){return $("meta[name=csrf-token]").attr("content")};settings.getCsrf=function(){var e=this.getCsrfParam();var t=this.getCsrfToken();if(e&&t){return{name:t}}else{return $("[name=_csrf]").val()}}})(jQuery);